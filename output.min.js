function GithubApi(t,e){var n="https://api.github.com",i=t+"/"+e,o=n+"/repos/"+i+"/commits",r=n+"/repos/"+i+"/contents";return this.getDiffBySha=function(t,e){var n=$("<span>Getting </span>");n.append($("<a>diff of sha"+t+"</a>").attr("href",o+"/"+t).attr("target","_blank")),notify(n.html()),this.request(o+"/"+t,e)},this.getDiff=function(t,e){var n={url:t,method:"GET",headers:{Accept:"application/vnd.github.diff"},params:{},data:{},responseType:"text"};n.success=function(t){e(t)},$.ajax(n)},this.getFile=function(t,e){notify("Get file "+t);var n={url:r+"/"+t,method:"GET",headers:{Accept:"application/vnd.github.raw"},responseType:"text"};n.success=e,this.request(r+"/"+t,e,{headers:{Accept:"application/vnd.github.raw"}})},this.getFileList=function(t){notify("Get list of files in root "),this.request(r,t)},this.getCommits=function(t){notify("Get list of commits"),this.request(o,t)},this.request=function(t,e,n){var i=_.extend({url:t,method:"GET",headers:{Accept:"application/vnd.github.diff"},params:{},data:{},responseType:"text",success:e},n||{});$.ajax(i)},this}function EditorInterface(t,e,n){var i=this;return i.speed=n,this.editor=t,this.github=e,this.runAllChanges=function(t,e){i.showEditFile(t,0,e,function(){console.log("completed show edit for all files")})},i.navigate=function(e,n){var o=t.getCursorPosition().row;t.scrollToLine(o-25),o!=e?(o>e?t.navigateUp():t.navigateDown(),setTimeout(function(){i.navigate(e,n)},50)):n()},i.rel=0,i.at=0,this.showSingleChange=function(e,o){var r=e.ln1||e.ln;r>=i.at&&"add"!=e.type&&(r+=i.rel),"add"==e.type&&(r-=1),i.navigate(r-1,function(){t.gotoLine(r),"del"==e.type?(i.rel=i.rel-1,i.at=r,t.removeLines(),setTimeout(function(){o()},n.getSpeed())):"normal"==e.type?o():"add"==e.type&&(t.navigateLineEnd(),t.insert("\n"),t.navigateLineStart(),setTimeout(function(){i.rel=i.rel+1;var r=e.content.trim().substring(1);writeNext(r,t,n,function(){o()})},80))})},this.showChangeEdit=function(t,e,n){return e>=t.length?void n():void i.showSingleChange(t[e],function(){i.showChangeEdit(t,e+1,n)})},this.showChunkEdit=function(t,e,n){if(e>=t.length)return void n();var o=t[e],r=o.changes;i.showChangeEdit(r,0,function(){i.showChunkEdit(t,e+1,n)})},this.showEditFile=function(e,n,o,r){if(i.rel=0,n>=e.length)return void r();var a=e[n],s=a.from;i.github.getFile(s+"?ref="+o,function(s){t.getSession().setMode("ace/mode/dockerfile"),t.setValue(s);var d=a.chunks;i.showChunkEdit(d,0,function(){i.showEditFile(e,n+1,o,r)})})},this}function App(t){var e=this,n=t,i=n.split("/");i.length<5&&notify("Bad url, cannot load "+n);var o=i[3],r=i[4];$("#githubUrl").val(githubUrl+o+"/"+r),e.ga=new GithubApi(o,r),e.ed=new EditorInterface(editor,this.ga,speed),this.getSha=function(){return n||console.log("no commit url"),i.length>6?i[6]:void console.log("no sha provided")};return e.sha=void 0,e.canStart=!1,this.update=function(t){if(t){if(e.sha=t,!e.canStart)return void console.log("that cannot start now",t);var n=e.commitMap[t].parents[0].sha;e.ga.getDiffBySha(t,function(t){window.diff=t;var i=fpp(t);e.ed.runAllChanges(i,n)},!0)}},e.commitMap={},e.ga.getCommits(function(t){e.commits=t;for(var n=0;n<t.length;n++)e.commitMap[t[n].sha]=t[n];e.canStart=!0;var i=$("#commitListTemplate").html();Mustache.parse(i);var o=Mustache.render(i,{commits:t});$("#commitListContainer").html(o),e.sha&&(console.log("get commit completed later"),e.update(e.sha))}),this}function initEditor(){var t="ace/theme/solarized_dark";editor=ace.edit("ace-editorid"),editor.$blockScrolling=1/0,editor.setTheme(t),$("#ace-mode").on("change",function(){editor.getSession().setMode("ace/mode/"+$(this).val().toLowerCase())}),$("#ace-theme").on("change",function(){editor.setTheme("ace/theme/"+$(this).val().toLowerCase())})}function loadUrl(t){console.log("load ",t),t.substr(0,githubUrl.length)==githubUrl&&(console.log("url has github"),t=t.substr(githubUrl.length));var e=githubUrl+t;window.app=new App(e),window.app.update(window.app.getSha())}function once(){var t=window.location.hash.substring(2);loadUrl(t)}function notify(t){$("#notifications").append($("<div class='list-group-item'></div>").html(t))}function updateSize(){var t=$(window).height()-62;$("#ace-editorid").css("height",t+"px"),$("#commitListContainer").css("height",t+"px"),$("#third").css("height",t+"px"),editor.resize()}var defaultToWhiteSpace,escapeRegExp,ltrim,makeString,parseFile,parseFileFallback,trimLeft,fpp=function(t){var e,n,i,o,r,a,s,d,l,c,u,h,f,p,g,m,v,w,S,b,$,y,E;if(!t)return[];if(t.match(/^\s+$/))return[];if(f=t.split("\n"),0===f.length)return[];for(s=[],a=null,g=0,p=0,i=null,y=function(t){var e;return a={chunks:[],deletions:0,additions:0},s.push(a),a.to||a.from||!(e=parseFile(t))?void 0:(a.from=e[0],a.to=e[1])},b=function(){return!a||a.chunks.length?y():void 0},m=function(){return b(),a["new"]=!0,a.from="/dev/null"},r=function(){return b(),a.deleted=!0,a.to="/dev/null"},l=function(t){return b(),a.index=t.split(" ").slice(1)},d=function(t){return b(),a.from=parseFileFallback(t)},E=function(t){return b(),a.to=parseFileFallback(t)},n=function(t,e){var n,o,r,s;return g=s=+e[1],r=+(e[2]||0),p=o=+e[3],n=+(e[4]||0),i={content:t,changes:[],oldStart:s,oldLines:r,newStart:o,newLines:n},a.chunks.push(i)},o=function(t){return i.changes.push({type:"del",del:!0,ln:g++,content:t}),a.deletions++},e=function(t){return i.changes.push({type:"add",add:!0,ln:p++,content:t}),a.additions++},v="\\ No newline at end of file",w=function(t){return a?i.changes.push({type:"normal",normal:!0,ln1:t!==v?g++:void 0,ln2:t!==v?p++:void 0,content:t}):void 0},$=[[/^\s+/,w],[/^diff\s/,y],[/^new file mode \d+$/,m],[/^deleted file mode \d+$/,r],[/^index\s[\da-zA-Z]+\.\.[\da-zA-Z]+(\s(\d+))?$/,l],[/^---\s/,d],[/^\+\+\+\s/,E],[/^@@\s+\-(\d+),?(\d+)?\s+\+(\d+),?(\d+)?\s@@/,n],[/^-/,o],[/^\+/,e]],S=function(t){var e,n,i,o;for(e=0,n=$.length;n>e;e++)if(o=$[e],i=t.match(o[0]))return o[1](t,i),!0;return!1},c=0,u=f.length;u>c;c++)h=f[c],S(h);return s};parseFile=function(t){var e;if(t)return e=t.split(" ").slice(-2),e.map(function(t,n){return e[n]=t.replace(/^(a|b)\//,"")}),e},parseFileFallback=function(t){var e;return t=ltrim(t,"-"),t=ltrim(t,"+"),t=t.trim(),e=/\t.*|\d{4}-\d\d-\d\d\s\d\d:\d\d:\d\d(.\d+)?\s(\+|-)\d\d\d\d/.exec(t),e&&(t=t.substring(0,e.index).trim()),t.match(/^(a|b)\//)?t.substr(2):t},ltrim=function(t,e){return t=makeString(t),!e&&trimLeft?trimLeft.call(t):(e=defaultToWhiteSpace(e),t.replace(new RegExp("^"+e+"+"),""))},makeString=function(t){return null===t?"":t+""},trimLeft=String.prototype.trimLeft,defaultToWhiteSpace=function(t){return null===t?"\\s":t.source?t.source:"["+escapeRegExp(t)+"]"},escapeRegExp=function(t){return makeString(t).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};var writeNext=function(t,e,n,i){return!t||t.length<1?void(i&&"function"==typeof i&&i()):(e.insert(t[0]),void setTimeout(function(){writeNext(t.substring(1),e,n,i)},n.getSpeed()/10))},Speed=function(){return this.speed=120,this.setSpeed=function(t){this.speed=10*t},this.getSpeed=function(){return 2*this.speed},this},speed=new Speed;$("#loadRepo").on("click",function(){$("#editorContainer").html('<div id="ace-editorid" class="row"></div>'),initEditor(),loadUrl($("#githubUrl").val())});var DelayedLoop=function(){};DelayedLoop.forEach=function(t,e,n,i){var o,r=0,a=function(){clearInterval(o);var s=n(t[r++]);if("boolean"!=typeof s||0!=s){if("number"!=typeof s)s=e;else if(0>s)return;r<t.length?o=setInterval(a,s):i()}};o=setInterval(function(){a()},e)};var editor=void 0;initEditor(),window.app={};var githubUrl="https://github.com/";$(window).on("hashchange",once),once();var store=window.localStorage,stored=store.getItem("speed");$(window).on("resize",function(){updateSize()}),updateSize();var slider=document.getElementById("slider");noUiSlider.create(slider,{start:80,connect:!1,orientation:"horizontal",range:{min:0,max:100}}),slider.noUiSlider.on("update",function(t){t=parseInt(t[0]),console.log("slide value ",t),store.setItem("speed",t),speed.setSpeed(t)}),stored&&(console.log("Stored value ",stored),speed.setSpeed(stored));